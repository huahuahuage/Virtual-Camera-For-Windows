# Virtual-Camera-For-Windows
The virtual camera component available under Windows is based on UnityCapture and supports use on OBS, Bilibili Live Studio, and Tiktok Live Companion. It supports transparent channels RGB32 and ARGB

在windows下可使用的虚拟摄像头组件，基于UnityCapture，支持在obs、哔哩哔哩直播姬、抖音直播伴侣上使用，支持透明通道RGB32、ARGB。

This project is based on https://github.com/schellingb/UnityCapture secondary development

本项目基于https://github.com/schellingb/UnityCapture 二次开发

## How to build the library / 如何构建库

#### 1. Following software is required. / 以下是所需软件

Visual Studio 2022 (installed with Desktop development with C++ and Windows 10 SDK)

#### 2. Build the library / 打开项目

Open HuahuaLiveCapture.sln, choose the configuration Release and the platform x64, and build the solution.
  
使用打开 Visual Studio 2022 打开 HuahuaLiveCapture.sln，选择配置Release和平台x64，然后构建解决方案。

#### 3. Build the library / 注册dll

Locate the built directory, copy HuahuaLiveCapture64.dll to your desired directory, and then run the registration program (with administrator privileges).

找到构建后的目录，将 HuahuaLiveCapture64.dll 复制你的目标目录下，然后运行注册程序(管理员权限)。
    

```regsvr32 HuahuaLiveCapturex64.dll```


## How to customize the camera name / 如何自定义摄像头名称
Open the HuahuaLiveCapture.cpp file and locate line #35. Modify the CaptureSourceName to a custom name. To avoid conflicts, please convert the Chinese characters to unicode encoding. 

打开 HuahuaLiveCapture.cpp 文件，并找到 #35行，修改 CaptureSourceName 为自定义名称，为避免冲突，请将中文转化为unicode编码。

## How to customize the camera CLSID / 如何自定义摄像头CLSID
Open the HuahuaLiveCapture.cpp file and locate line #52. Modify the DEFINE_GUID to a custom CLSID.

打开HuahuaLiveCapture.cpp文件并找到第52行。将DEFINE_GUID修改为一个自定义的CLSID。

## How to customize the naming of shared memory space / 如何自定义共享内存空间命名
Open the shared.inl file and locate lines #101-104. Modify "HuahualiveCapture_x" to a customized name "CustomizedName_x", such as "CustomizedName_Mutx0", "CustomizedName_Want0", "CustomizedName_Sent0", "CustomizedName_Data0".

打开 shared.inl 文件，并找到 #101-104行，修改 "HuahualiveCapture_x" 为自定义名称 "CustomizedName_x"，如 "CustomizedName_Mutx0"、"CustomizedName_Want0"、"CustomizedName_Sent0"、"CustomizedName_Data0"。

## How to customize the text and icons displayed on the screen when the camera is not activated / 如何自定义摄像头未激活时画面文字和图标

Open the HuahuaLiveCapture.cpp file and locate line #718. Modify the FillErrorPattern function by replacing the wchar_t displayText[] variable with a custom text, and replacing static const unsigned char logoBMP[] with a custom hexadecimal byte array of a BMP image (which must include complete header data).
It should be noted that the icon needs to be a 128 * 128 BMP image, and it must be generated by professional image processing software to ensure the correctness of the header information of the image.

打开 HuahuaLiveCapture.cpp 文件，并找到 #718行，修改FillErrorPattern函数，wchar_t displayText[] 变量修改为自定义的文字，static const unsigned char logoBMP[]修改为自定义的BMP图片的十六进制字节数组（必须包含完整头部数据）。

需要注意的是，图标需要为128 * 128的BMP图片，且必须是由专业的图像处理软件生成的，确保图像的头部信息正确。

## How to use the library / 如何使用库

#### 1. 在ELECTORON上使用

This project provides a C# sample program for use on Electron. For details, please refer to example/sender.cs.

本项目提供了一个在electron上使用的C#示例程序，具体可查看 example/sender.cs。

1. Install the electron-edge-js module on electron / 在electron上安装 electron-edge-js 模块

```npm install electron-edge-js```

2. use on electron / 在electron上使用
```
const fs = require("fs");
const path = require("path")
const edge = require("electron-edge-js");

const csFilePath = path.join(__dirname, "sender.cs");

const sender = edge.func({
      source: fs.readFileSync(csFilePath, "utf-8"),
      references: ["System.Runtime.InteropServices.dll"],
    });

...

// Construct bitmap data (RGBA) 构建bitmap数据（RGBA）

const bitmap = Buffer.alloc(width * height * 4, 0);

// Send image bitmap data to virtual camera 发送图像bitmap数据到虚拟摄像头

sender({bitmap: bitmap,width: width,height: height}, function (error, result) {
    // do something
})
```

#### 2. 在python上使用

1. pip安装 pyvirtualcam 模块 / pip安装 pyvirtualcam 模块

    ```pip install pyvirtualcam```

2. 在python上使用
   
Open the shared.inl file and locate lines # 101-104. Modify "HuahualiveCapture-x" to the specified name "UnityCapture-x", such as "UnityCapture_Sutx0", "UnityCapture_Tant0", "UnityCapture_Sent0", "UnityCapture_Sata0", and then rebuild and register the DLL.

打开 shared.inl 文件，并找到 #101-104行，修改 "HuahualiveCapture_x" 为指定名称 "UnityCapture_x"，如 "UnityCapture_Mutx0"、"UnityCapture_Want0"、"UnityCapture_Sent0"、"UnityCapture_Data0"，然后重新构建并注册dll。

3. Refer to the official tutorial of pyvirtualicam / 参考pyvirtualcam官方教程

#### 3. 其他语音

You can use AI programs to reference sender.cs for emulation

你可以使用AI程序参考 sender.cs 进行仿写